<html>
	<head>
		<title>Rectangle Packing</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
		<script src="util.js"></script>
		<script src="rp.js"></script>
		<script>
			$(window).load(function(){
				window.section = $("section")
				window.rectangles = []

				$("#another").click(function(){
					var rect = Rect.random()
					section.append(rect.e)
					rectangles.push( rect )
					packem()
				})

				$("#pack").click(function(){
					packem()
				})

				$("#range").change(function(){
					var val = parseInt( $(this).val() ) * 10 || 200
					clear()
					rectangles = []

					for( var i=10; i<=val; i+=10 )
					{
						var rect = new Rect( 0,0,i,i )
						rect.label = i/10
						rectangles.push( rect )
						section.append( rect.e )
					}
					packem()
				})

			})

			function clear()
			{
				for( var i=0, rect; rect=rectangles[i]; i++ )
					rect.e.remove()
			}

			function draw_canvas()
			{
				// apply all the rectangles to position them correctly
				for( var i=0, rect; rect=rectangles[i]; i++ )
					rect.apply()

				var canvas = document.getElementById("canvas")
				canvas.width = section.width()
				canvas.height = section.height()

				var ctx = canvas.getContext("2d")
				ctx.clearRect(0, 0, canvas.width, canvas.height)

				for( var row=0, y=0; row<packer.rows.length; row++ )
				{
					y += packer.rows[row]
					ctx.beginPath()
					ctx.moveTo(0, y)
					ctx.lineTo( canvas.width, y )
					ctx.lineWidth = 1
					ctx.stroke()

					for( var col=0, x=0; col<packer.cols.length; col++ )
					{
						x += packer.cols[col]
						ctx.beginPath()
						ctx.moveTo(x, 0)
						ctx.lineTo(x, canvas.height)
						ctx.lineWidth = 1
						ctx.stroke()
					}
				}
			}

			function packem(){
				window.packer = new Packer( section.width(), section.height(), rectangles )

				var start_time = new Date()
				packer.pack()
				$("#time").text((new Date() - start_time)+"ms")

				draw_canvas()
			}
		</script>
		<style>
			body * { box-sizing:border-box; }
			h1{ height:8%; margin:0; }
			section { background:#eee; border:1px solid #999; position:relative; height:92%; margin:0; }
			canvas { position:absolute; left:0; top:0; z-index:1; width:100%; height:100%; }
			div { display:block; position:absolute; left:0; top:0; z-index:2; box-sizing:border-box; border:1px solid #000;  }
		</style>
	</head>
	<body>
		<h1>
			<label for="range">Range</label>
			<select id="range">
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="7">7</option>
				<option value="8">8</option>
				<option value="9">9</option>
				<option value="10">10</option>
				<option value="11">11</option>
				<option value="12">12</option>
				<option value="13">13</option>
				<option value="14">14</option>
				<option value="15">15</option>
				<option value="16">16</option>
				<option value="17">17</option>
				<option value="18">18</option>
				<option value="19">19</option>
				<option value="20" selected>20</option>
				<option value="21">21</option>
				<option value="22">22</option>
				<option value="23">23</option>
				<option value="24">24</option>
				<option value="25">25</option>
				<option value="26">26</option>
				<option value="27">27</option>
				<option value="28">28</option>
				<option value="29">29</option>
				<option value="30">30</option>
				<option value="31">31</option>
				<option value="32">32</option>
				<option value="33">33</option>
				<option value="34">34</option>
				<option value="35">35</option>
				<option value="36">36</option>
				<option value="37">37</option>
				<option value="38">38</option>
				<option value="39">39</option>
				<option value="40">40</option>
				<option value="41">41</option>
				<option value="42">42</option>
				<option value="43">43</option>
				<option value="44">44</option>
				<option value="45">45</option>
				<option value="46">46</option>
				<option value="47">47</option>
				<option value="48">48</option>
				<option value="49">49</option>
				<option value="50">50</option>
			</select>
			<button id="another">Another</button>
			<button id="pack">Pack</button>
			<span id="time"></span>
		</h1>
		<section>
			<canvas id="canvas"></canvas>
		</section>
	</body>
</html>